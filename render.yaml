services:
  - type: web
    name: foreign-language-assessment
    env: python
    region: frankfurt  # or your preferred region
    plan: starter  # or free for testing

    # FFmpeg is required for audio file processing
    buildCommand: |
      # Install FFmpeg for audio processing
      apt-get update && apt-get install -y ffmpeg
      # Install Python dependencies
      pip install -r backend/requirements.txt
      # Install frontend dependencies and build
      npm install --prefix frontend
      # Build frontend with Render's auto-generated URL
      # RENDER_EXTERNAL_URL is automatically available during build
      export VITE_API_BASE_URL=${RENDER_EXTERNAL_URL:-http://localhost:8000}
      npm run build --prefix frontend

    startCommand: bash start.sh

    # Environment variables - configure these in Render Dashboard
    envVars:
      - key: APP_SECRET_TOKEN
        generateValue: true  # Render will generate a secure token
      # Note: APP_BASE_URL uses Render's auto-generated RENDER_EXTERNAL_URL
      # No need to manually configure the URL - it's automatically available!
      - key: REPORT_LANGUAGE
        value: en
      - key: STORE_TRANSCRIPTS
        value: true
      # Email and GPT5 keys should be added manually in Render Dashboard for security

    # Persistent disk for audio files and reports
    disk:
      name: assessment-data
      mountPath: /opt/render/project/src/backend
      sizeGB: 1

    # Health check configuration
    healthCheckPath: /health

    # Auto-deploy from main branch
    autoDeploy: true
